<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lanceur de Discussion - Jeu de Cartes</title>
  <style>
    :root{
      /* Palette principale (option 3) */
      --primary-1:#00857C;
      --primary-2:#4B7CA2;
      --primary-grad: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 100%);

      /* Accents chauds pour appels Ã  lâ€™action / badges */
      --accent-1:#F5B700;  /* or #F59E0B si tu prÃ©fÃ¨res un peu plus orangÃ© */
      --accent-2:#F08A24;
      --accent-grad: linear-gradient(135deg, var(--accent-1), var(--accent-2));

      /* Surfaces & textes */
      --surface:#ffffff;
      --surface-muted:#F3FAF9;
      --text:#2d3748;
      --text-inverse:#ffffff;

      /* Variantes foncÃ©es pour dos de carte (teal/bleu-gris profonds) */
      --card-front-a:#0F4C48;
      --card-front-b:#0B314A;

      /* Bordures/ombres */
      --border:#e2e8f0;
      --shadow-1: rgba(0,0,0,0.2);
      --shadow-2: rgba(0,0,0,0.3);
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--primary-grad);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:20px;
      overflow-x:hidden;
    }

    .title{
      color:var(--text-inverse);
      font-size:2.5rem;
      font-weight:700;
      text-align:center;
      margin-bottom:3rem;
      text-shadow:2px 2px 4px rgba(0,0,0,0.3);
    }

    .game-container{
      position:relative;
      width:100%;
      max-width:800px;
      height:500px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card-deck{
      position:absolute;
      right:50px;
      width:120px;
      height:180px;
      cursor:pointer;
      transform-style:preserve-3d;
      transition:transform .3s ease;
    }
    .card-deck:hover{ transform: translateY(-10px) scale(1.05); }

    .deck-card{
      position:absolute;
      width:100%;height:100%;
      background: linear-gradient(145deg, var(--card-front-a), var(--card-front-b));
      border-radius:12px;
      border:3px solid var(--border);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 8px 25px var(--shadow-2);
      color:var(--text-inverse);
      font-weight:800;
      font-size:2rem;
      opacity:.9;
    }
    .deck-card:nth-child(1){ transform: translateZ(0px) rotate(0deg); }
    .deck-card:nth-child(2){ transform: translateZ(-2px) rotate(1deg); }
    .deck-card:nth-child(3){ transform: translateZ(-4px) rotate(-1deg); }

    .card-container{
      width:350px;height:200px;perspective:1000px;
      transform:translateX(-50px);
      opacity:0;transition:all .5s ease;
      position:relative;
    }
    .card-container.visible{ opacity:1; transform:translateX(0); }

    .expert-button{
      position:absolute;
      top:-18px;
      right:-18px;
      width:46px;
      height:46px;
      border-radius:50%;
      border:none;
      background:var(--accent-grad);
      color:var(--text-inverse);
      font-size:1.6rem;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 10px 25px rgba(240,138,36,0.35);
      cursor:pointer;
      transition:transform .3s ease, box-shadow .3s ease;
      z-index:5;
    }
    .expert-button:hover:not([disabled]){ transform:translateY(-4px) scale(1.05); box-shadow:0 12px 30px rgba(240,138,36,0.45); }
    .expert-button:active:not([disabled]){ transform:translateY(0) scale(1); }
    .expert-button[disabled]{ opacity:0.4; cursor:not-allowed; box-shadow:none; }

    .discussion-card{
      width:100%;height:100%;position:relative;
      transform-style:preserve-3d;
      transition: transform .8s cubic-bezier(0.175,0.885,0.32,1.275);
    }
    .discussion-card.flipping{ transform: rotateY(180deg); }

    .card-face{
      position:absolute; inset:0;
      border-radius:20px; border:3px solid var(--border);
      padding:30px; display:flex; flex-direction:column;
      align-items:center; justify-content:center; text-align:center;
      box-shadow:0 15px 40px var(--shadow-1);
      backface-visibility:hidden; overflow:hidden;
    }

    .card-front{
      background: linear-gradient(145deg, var(--card-front-a), var(--card-front-b));
      color:var(--text-inverse);
      transform: rotateY(0deg);
    }

    .card-back{
      background: linear-gradient(145deg, var(--surface), var(--surface-muted));
      color:var(--text);
      transform: rotateY(180deg);
    }

    .card-front-content{
      display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;
    }
    .card-front{ font-size:3rem; margin-bottom:15px; opacity:.9; }
    .card-front-text{
      font-size:1rem; opacity:.95; font-weight:600; text-transform:uppercase; letter-spacing:2px;
    }

    .flip-hint{
      position:absolute; bottom:10px; right:15px; font-size:.8rem; opacity:.8; animation:pulse 2s infinite; color:var(--text-inverse);
    }
    @keyframes pulse{ 0%,100%{opacity:.7;} 50%{opacity:1;} }

    .card-category{
      background: var(--primary-grad);
      color:var(--text-inverse);
      padding:8px 16px; border-radius:20px; font-size:.8rem; font-weight:700;
      text-transform:uppercase; letter-spacing:1px; margin-bottom:20px;
      box-shadow:0 4px 15px rgba(0,133,124,0.35);
    }

    .card-content{
      color:var(--text); font-size:1.1rem; line-height:1.6; font-weight:500;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.06);
    }

    .controls{
      margin-top:3rem; display:flex; gap:20px; flex-wrap:wrap; justify-content:center;
    }

    .btn{
      padding:15px 30px; border:none; border-radius:50px; font-size:1rem; font-weight:700; cursor:pointer;
      transition:all .3s ease; text-transform:uppercase; letter-spacing:1px;
      box-shadow:0 4px 15px var(--shadow-2); position:relative; overflow:hidden;
    }
    .btn:hover{ transform: translateY(-2px); box-shadow:0 6px 20px rgba(0,0,0,0.3); }
    .btn:active{ transform: translateY(0); }

    .btn-primary{ background: var(--primary-grad); color:var(--text-inverse); }
    .btn-secondary{ background: var(--accent-grad); color:var(--text-inverse); }

    .deck-counter{
      position:absolute; top:-15px; right:-15px;
      background: var(--accent-grad);
      color:var(--text-inverse);
      width:35px; height:35px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-weight:800; font-size:.9rem;
      box-shadow:0 4px 15px rgba(245,183,0,0.4);
      border:2px solid rgba(255,255,255,0.6);
    }

    .modal-overlay{
      position:fixed;
      inset:0;
      background:rgba(8,33,41,0.75);
      backdrop-filter:blur(6px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      opacity:0;
      pointer-events:none;
      transition:opacity .3s ease;
      z-index:1000;
    }

    .modal-overlay.visible{ opacity:1; pointer-events:auto; }

    .modal-content{
      background:var(--surface);
      color:var(--text);
      max-width:520px;
      width:100%;
      border-radius:18px;
      padding:30px;
      box-shadow:0 20px 45px rgba(0,0,0,0.25);
      display:flex;
      flex-direction:column;
      gap:20px;
    }

    .expert-modal-content{
      max-width:640px;
    }

    .expert-situation,
    .expert-advice{
      background:var(--surface-muted);
      border-radius:14px;
      padding:18px;
      border:1px solid rgba(0,133,124,0.2);
      box-shadow:0 6px 18px rgba(11,49,74,0.08);
    }

    .expert-section-title{
      font-size:.9rem;
      text-transform:uppercase;
      letter-spacing:1.5px;
      font-weight:700;
      color:var(--primary-1);
      margin-bottom:10px;
    }

    .expert-category{
      font-weight:700;
      margin-bottom:6px;
      color:var(--primary-2);
    }

    .expert-situation-text{
      font-size:1rem;
      line-height:1.6;
    }

    .expert-advice-text p{
      margin-bottom:12px;
      line-height:1.65;
      text-align:left;
    }

    .expert-advice-text p:last-child{ margin-bottom:0; }

    .modal-title{
      font-size:1.6rem;
      font-weight:700;
      text-align:center;
    }

    .modal-description{
      font-size:1rem;
      line-height:1.5;
      text-align:center;
      color:#445869;
    }

    .select-all{
      display:flex;
      justify-content:flex-end;
      font-weight:600;
      color:#2b4d5c;
    }

    .theme-options{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:12px;
      max-height:240px;
      overflow:auto;
      padding-right:4px;
    }

    .theme-option{
      background:var(--surface-muted);
      border-radius:14px;
      padding:12px 14px;
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:600;
      border:1px solid rgba(0,133,124,0.15);
      box-shadow:0 4px 12px rgba(11,49,74,0.06);
      transition:transform .2s ease, box-shadow .2s ease;
    }

    .theme-option input{ accent-color:var(--primary-1); width:18px; height:18px; }

    .theme-option:hover{ transform:translateY(-2px); box-shadow:0 8px 20px rgba(11,49,74,0.12); }

    .modal-actions{
      display:flex;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
    }

    .modal-error{
      color:#b91c1c;
      font-weight:600;
      text-align:center;
      min-height:20px;
    }

    #openThemeSelector{ background:var(--surface); color:var(--primary-1); border:2px solid rgba(0,133,124,0.35); }
    #openThemeSelector:hover{ color:var(--text-inverse); background:var(--primary-grad); }

    .floating-particles{
      position:fixed; inset:0; pointer-events:none; z-index:-1;
    }
    .particle{
      position:absolute; width:4px; height:4px; background: rgba(255,255,255,0.35);
      border-radius:50%; animation: float 6s ease-in-out infinite;
    }
    @keyframes float{
      0%,100%{ transform:translateY(0) rotate(0deg); opacity:0; }
      50%{ transform:translateY(-100px) rotate(180deg); opacity:1; }
    }

    @media (max-width:768px){
      .title{ font-size:2rem; margin-bottom:2rem; }
      .game-container{ height:400px; flex-direction:column; gap:30px; }
      .card-deck{ position:relative; right:auto; }
      .card-container{ width:300px; height:180px; transform:none; }
      .card-container.visible{ transform:none; }
    }
  </style>
</head>
<body>
  <!-- Particules flottantes -->
  <div class="floating-particles"></div>

  <h1 class="title">ğŸ’¬ Lanceur de Discussion</h1>

  <div class="game-container">
    <!-- Tas de cartes -->
    <div class="card-deck" id="cardDeck" onclick="drawCard()">
      <div class="deck-card"><div class="deck-icon">?</div></div>
      <div class="deck-card"><div class="deck-icon">?</div></div>
      <div class="deck-card"><div class="deck-icon">?</div></div>
      <div class="deck-counter" id="cardCounter">24</div>
    </div>

    <!-- Carte de discussion avec effet flip -->
    <div class="card-container" id="cardContainer">
      <button class="expert-button" id="expertAdviceBtn" type="button" title="Voir les recommandations des experts" aria-label="Afficher les recommandations des experts">ğŸ’¡</button>
      <div class="discussion-card" id="discussionCard">
        <!-- Face avant (dos de carte) -->
        <div class="card-face card-front">
          <div class="card-front-content">
            <div class="card-front-text">Question</div>
          </div>
          <div class="flip-hint">Cliquez pour rÃ©vÃ©ler ğŸ‘‰</div>
        </div>

        <!-- Face arriÃ¨re (contenu) -->
        <div class="card-face card-back">
          <div class="card-category" id="cardCategory">Bienvenue</div>
          <div class="card-content" id="cardContent">
            Cliquez sur cette carte ou sur le tas de cartes pour dÃ©couvrir votre premiÃ¨re question de discussion !
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-primary" onclick="drawCard()">Nouvelle Carte</button>
    <button class="btn btn-secondary" onclick="resetDeck()">RÃ©initialiser</button>
    <button class="btn" id="openThemeSelector">Choisir les thÃ©matiques</button>
  </div>

  <div class="modal-overlay" id="themeSelectorModal">
    <div class="modal-content">
      <h2 class="modal-title">Choisissez vos thÃ©matiques</h2>
      <p class="modal-description">SÃ©lectionnez les thÃ©matiques que vous souhaitez voir apparaÃ®tre dans votre partie. Vous pourrez modifier ce choix Ã  tout moment.</p>
      <div class="select-all">
        <label for="selectAllThemes"><input type="checkbox" id="selectAllThemes" checked> Tout sÃ©lectionner</label>
      </div>
      <div class="theme-options" id="themeOptions"></div>
      <div class="modal-error" id="themeError"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="applyThemeSelection">Valider la sÃ©lection</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="expertAdviceModal" aria-hidden="true">
    <div class="modal-content expert-modal-content" role="dialog" aria-modal="true" aria-labelledby="expertAdviceTitle">
      <div class="expert-situation">
        <div class="expert-section-title">Situation</div>
        <div class="expert-category" id="expertAdviceCategory"></div>
        <p class="expert-situation-text" id="expertAdviceSituation"></p>
      </div>
      <div class="expert-advice">
        <div class="expert-section-title" id="expertAdviceTitle">Recommandations des experts</div>
        <div class="expert-advice-text" id="expertAdviceContent"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-primary" id="closeExpertAdvice" type="button">Fermer</button>
      </div>
    </div>
  </div>

  <!-- DonnÃ©es XML intÃ©grÃ©es -->
  <script type="text/xml" id="cardsData">
    <cards>
      <card category="Gestion des Ã©motions">
        <content>Ton enfant de 3 ans se met Ã  hurler parce que tu refuses un deuxiÃ¨me biscuit. Quelle premiÃ¨re phrase pourrais-tu lui dire pour valider son Ã©motion tout en gardant la limite ?</content>
        <advice>
          Commence par respirer avec lui et mets-toi Ã  sa hauteur pour maintenir la connexion. DÃ©cris ce que tu observes : Â« Tu es trÃ¨s dÃ©Ã§u parce que je dis non au biscuit Â» puis laisse-lui quelques secondes pour dÃ©charger sans jugement.

          Rappelle ensuite la limite calmement en expliquant le pourquoi : Â« Notre corps a besoin de faire une pause avec le sucre Â». Propose une alternative claire comme un verre dâ€™eau ou un jeu de transition afin quâ€™il sente quâ€™il nâ€™est pas laissÃ© seul avec sa frustration.
        </advice>
      </card>
      <card category="CoopÃ©ration quotidienne">
        <content>Au moment de se brosser les dents, ton enfant se cache sous la table en criant Â« Non ! Â». Comment pourrais-tu reformuler la consigne pour crÃ©er une alliance et avancer ensemble ?</content>
        <advice>
          Utilise un ton ludique et descriptif : Â« Jâ€™ai deux brosses super-hÃ©ros qui cherchent un volontaire, laquelle choisissons-nous ? Â». Cette reformulation rÃ©introduit le jeu et lui permet de se sentir acteur plutÃ´t quâ€™opposÃ©.

          Offre un micro-choix pour restaurer son sentiment de contrÃ´le : Â« Tu prÃ©fÃ¨res que je commence par les dents du haut ou du bas ? Â». En lâ€™invitant dans la tÃ¢che, tu maintiens la limite tout en nourrissant lâ€™alliance.
        </advice>
      </card>
      <card category="Frustration et apprentissages">
        <content>AprÃ¨s avoir perdu Ã  un jeu de sociÃ©tÃ©, ton enfant renverse le plateau. Quelle invitation Ã  la rÃ©flexion pourrais-tu lui proposer pour lâ€™aider Ã  nommer sa frustration ?</content>
        <advice>
          Valide dâ€™abord son vÃ©cu avant de chercher une solution : Â« Tu aurais aimÃ© gagner et câ€™est dur quand la partie sâ€™arrÃªte comme Ã§a Â». Reste prÃ¨s de lui physiquement pour quâ€™il sente que tu accueilles son Ã©motion.

          Quand lâ€™intensitÃ© baisse, propose une question ouverte : Â« Quâ€™est-ce qui tâ€™aiderait la prochaine fois quand tu sens la colÃ¨re arriver ? Â». Encourage-le Ã  imaginer une stratÃ©gie concrÃ¨te (respirer, demander une pause, serrer un coussin) et co-crÃ©ez un plan pour la prochaine partie.
        </advice>
      </card>
      <card category="RivalitÃ©s fraternelles">
        <content>Deux frÃ¨res se disputent la mÃªme peluche et commencent Ã  se pousser. Comment pourrais-tu intervenir pour reconnaÃ®tre les besoins de chacun avant de chercher une solution ?</content>
        <advice>
          Stoppe le geste en posant une main rassurante entre eux et rappelle la rÃ¨gle de sÃ©curitÃ© : Â« Je vois deux enfants qui veulent la mÃªme peluche, et je ne laisserai personne se faire mal Â». Parle lentement pour inviter tout le monde Ã  ralentir.

          Donne la parole Ã  tour de rÃ´le : Â« Jâ€™Ã©coute dâ€™abord Paul, puis LÃ©a Â». Reformule leurs besoins (jouer, Ãªtre rassurÃ©, avoir un tour) puis sollicite leur crÃ©ativitÃ© : Â« Quelles idÃ©es avez-vous pour que chacun soit satisfait ? Â». Cette mÃ©diation les aide Ã  apprendre la coopÃ©ration plutÃ´t que lâ€™arbitrage automatique.
        </advice>
      </card>
      <card category="Rituels du soir">
        <content>Ã€ lâ€™heure du coucher, ton enfant rÃ©clame encore une histoire et dit quâ€™il nâ€™est pas fatiguÃ©. Quelle routine apaisante pourrais-tu co-construire pour sÃ©curiser la transition vers le sommeil ?</content>
        <advice>
          Annonce la fin de journÃ©e avec un rituel prÃ©visible : Â« Dans cinq minutes, nous passerons en mode dodo Â». Utilise des repÃ¨res sensoriels constants (lampe douce, musique calme) pour prÃ©parer le corps Ã  ralentir.

          Co-crÃ©ez une sÃ©quence en trois temps : moment de connexion (cÃ¢lin, mini jeu), histoire courte, puis rituel autonome (respiration, massage des mains). En lui donnant un rÃ´le actif dans cette routine, tu facilites lâ€™acceptation de la limite tout en nourrissant la sÃ©curitÃ©.
        </advice>
      </card>
      <card category="Limites bienveillantes">
        <content>Ton enfant tape son parent quand la frustration monte. Quelle formulation claire et ferme, mais reliÃ©e, peux-tu utiliser pour rappeler la rÃ¨gle et proposer une alternative ?</content>
        <advice>
          Garde un ton posÃ© et rapproche-toi sans agressivitÃ© : Â« Je vois que tu es trÃ¨s en colÃ¨re, et je ne te laisserai pas taper Â». Nomme ce que tu protÃ¨ges (ton corps, le sien, la relation) pour que la rÃ¨gle fasse sens.

          Propose immÃ©diatement un geste de substitution : Â« Tu peux serrer ce coussin ou taper tes pieds par terre pour dire ta colÃ¨re Â». Reste Ã  proximitÃ© pour lâ€™aider Ã  traverser lâ€™Ã©motion, puis dÃ©briefe plus tard quand tout le monde est revenu au calme.
        </advice>
      </card>
      <card category="Autonomie accompagnÃ©e">
        <content>Il refuse de sâ€™habiller seul mais rejette ton aide. Quel choix limitÃ© inspirÃ© de lâ€™Ã©ducation positive pourrais-tu offrir pour quâ€™il se sente compÃ©tent ?</content>
        <advice>
          Valide son besoin dâ€™autonomie : Â« Tu aimerais y arriver tout seul et en mÃªme temps câ€™est difficile ce matin Â». Ã‰vite dâ€™imposer ton rythme immÃ©diatement, offre-lui plutÃ´t un espace de rÃ©ussite progressive.

          Propose deux options gagnantes : Â« Tu choisis de mettre le tee-shirt et je tâ€™aide pour le pantalon, ou lâ€™inverse Â». En explicitant que vous formez une Ã©quipe, il perÃ§oit ton soutien sans se sentir envahi.
        </advice>
      </card>
      <card category="Transitions douces">
        <content>Au parc, il est lâ€™heure de partir mais ton enfant crie quâ€™il veut rester. Quelle stratÃ©gie dâ€™anticipation ou de fermeture positive pourrais-tu proposer pour respecter le cadre sans rupture brutale ?</content>
        <advice>
          PrÃ©viens quelques minutes avant le dÃ©part avec un signal clair : Â« Encore deux tours de toboggan et nous partons Â». Laisse-le choisir comment vivre ces deux tours pour renforcer son sentiment de maÃ®trise.

          Ã€ lâ€™heure dite, invite-le Ã  un rituel de clÃ´ture : remercier le parc, saluer un copain ou prendre une photo mentale. Ensuite, propose une perspective agrÃ©able pour la suite (choisir la musique de la voiture, raconter son moment prÃ©fÃ©rÃ©). Cette continuitÃ© lâ€™aide Ã  changer dâ€™activitÃ© sans se sentir arrachÃ©.
        </advice>
      </card>
      <card category="Communication Ã©motionnelle">
        <content>Ton enfant te dit Â« je te dÃ©teste Â» aprÃ¨s un refus. Quelle rÃ©ponse pourrait tÃ©moigner de ton ancrage et ouvrir un dialogue sur ce quâ€™il ressent vraiment ?</content>
        <advice>
          ReÃ§ois ses mots sans les prendre personnellement : Â« Tu es tellement fÃ¢chÃ© que tu dis des mots trÃ¨s forts Â». Ta stabilitÃ© lui montre que lâ€™Ã©motion peut Ãªtre exprimÃ©e sans que la relation se brise.

          Invite-le Ã  prÃ©ciser ce qui se passe dedans : Â« Quâ€™est-ce qui te pique autant ? Â» ou Â« De quoi aurais-tu besoin maintenant ? Â». Lorsque le calme revient, explique que toutes les Ã©motions sont bienvenues mais que vous cherchez ensemble des mots qui respectent chacun.
        </advice>
      </card>
      <card category="Empathie sociale">
        <content>Il revient de lâ€™Ã©cole triste car un camarade ne veut plus jouer avec lui. Comment lâ€™aider Ã  accueillir sa peine tout en explorant ce dont il a besoin pour se sentir soutenu ?</content>
        <advice>
          Accueille sa tristesse avant de chercher une solution : Â« Câ€™est douloureux quand un ami sâ€™Ã©loigne, je suis lÃ  Â». Encourage-le Ã  raconter la scÃ¨ne pour quâ€™il puisse la digÃ©rer Ã©motionnellement.

          Demande-lui ce qui lâ€™aiderait : un cÃ¢lin, du temps seul, ou rÃ©flÃ©chir Ã  une invitation. Ensuite, explore ensemble diffÃ©rentes options (parler au camarade, proposer un autre jeu, demander de lâ€™aide Ã  lâ€™enseignant) pour quâ€™il retrouve du pouvoir dâ€™agir.
        </advice>
      </card>
      <card category="RÃ©paration et responsabilitÃ©">
        <content>Ton enfant casse volontairement le dessin de sa sÅ“ur. Quelle conversation pourrais-tu amorcer pour lâ€™accompagner vers la rÃ©paration plutÃ´t que la punition ?</content>
        <advice>
          Mets en pause lâ€™Ã©lan punitif et dÃ©cris factuellement : Â« Le dessin de ta sÅ“ur est dÃ©chirÃ© et elle est trÃ¨s dÃ©Ã§ue Â». VÃ©rifie ce quâ€™il se passait pour lui juste avant lâ€™acte afin de comprendre lâ€™Ã©motion sous-jacente.

          Parlez ensuite de rÃ©paration : Â« Que peux-tu faire pour prendre soin de sa sÅ“ur et de votre lien ? Â». Laisse-le proposer (recoller, refaire un dessin, offrir un temps ensemble) et soutiens-le dans la mise en Å“uvre pour quâ€™il expÃ©rimente la responsabilitÃ© plutÃ´t que la honte.
        </advice>
      </card>
      <card category="Participation aux tÃ¢ches">
        <content>Chaque matin, il refuse de mettre son bol dans lâ€™Ã©vier. Quelle maniÃ¨re ludique pourrais-tu co-crÃ©er pour transformer la consigne en responsabilitÃ© valorisante ?</content>
        <advice>
          Transforme la consigne en mission : Â« Jâ€™ai besoin du chef des bols pour lancer le lave-vaisselle, tu es partant ? Â». Un rituel nommÃ© (mission fusÃ©e, Ã©quipe service) valorise sa participation.

          Instaurez ensemble un tableau de rÃ©ussite relationnelle : au lieu de rÃ©compenses matÃ©rielles, propose un moment de partage quand la mission est remplie (danse du matin, tape dans la main). Il sent alors que sa contribution compte rÃ©ellement pour la famille.
        </advice>
      </card>
      <card category="Gestion de ta propre Ã©motion">
        <content>Tu sens la colÃ¨re monter aprÃ¨s une succession de refus. Quelle phrase dâ€™auto-coaching ou micro-pause peux-tu utiliser pour revenir dans une prÃ©sence calme avant de rÃ©pondre ?</content>
        <advice>
          Offre-toi une pause consciente : pose la main sur ton ventre et inspire profondÃ©ment en te disant Â« Je peux ralentir et choisir ma rÃ©ponse Â». Ce micro-rituel signale Ã  ton corps que tu reprends les commandes.

          Si besoin, verbalise Ã  ton enfant : Â« Jâ€™ai besoin de quelques secondes pour me calmer et revenir te voir Â». En modÃ©lisant cette autorÃ©gulation, tu lui montres que prendre soin de ses Ã©motions est une compÃ©tence Ã  cultiver ensemble.
        </advice>
      </card>
      <card category="Usage des Ã©crans">
        <content>Ton enfant rÃ©clame Â« encore cinq minutes Â» de dessin animÃ© et la nÃ©gociation dÃ©gÃ©nÃ¨re. Comment poser un cadre clair tout en proposant un plan de sortie qui respecte vos besoins ?</content>
        <advice>
          Clarifie le cadre Ã  froid : dÃ©finissez Ã  lâ€™avance le nombre dâ€™Ã©pisodes ou le minuteur, et annonce lâ€™approche de la fin quelques minutes avant lâ€™arrÃªt effectif. Ainsi, lâ€™enfant sait Ã  quoi sâ€™attendre.

          Au moment de couper, propose une activitÃ© passerelle : choisir une chanson, prÃ©parer le goÃ»ter, bouger le corps. Rappelle que la limite est non nÃ©gociable tout en reconnaissant sa frustration : Â« Tu voulais continuer, câ€™est difficile de sâ€™arrÃªter, je suis avec toi Â».
        </advice>
      </card>
      <card category="Partenariat avec lâ€™Ã©cole">
        <content>Lâ€™enseignant signale que ton enfant coupe souvent la parole en classe. Quelle discussion Ã  la maison pourrait encourager la conscience de soi et lâ€™Ã©coute active ?</content>
        <advice>
          Partage lâ€™information sans accusation : Â« Ton enseignant mâ€™a dit que tu as beaucoup dâ€™idÃ©es et quâ€™il est parfois difficile de laisser les autres parler Â». Invite-le Ã  raconter sa version pour quâ€™il se sente entendu.

          Explore avec lui des stratÃ©gies dâ€™autorÃ©gulation : lever la main, compter jusquâ€™Ã  trois, noter son idÃ©e. Envisagez ensemble un signe discret avec lâ€™enseignant ou un carnet dâ€™idÃ©es. En lâ€™impliquant dans le plan, tu dÃ©veloppes son sentiment de compÃ©tence sociale.
        </advice>
      </card>
      <card category="Motivation intrinsÃ¨que">
        <content>Ton enfant rechigne Ã  faire ses devoirs sans rÃ©compense. Comment pourrais-tu lâ€™aider Ã  identifier ce qui rend lâ€™apprentissage important pour lui, plutÃ´t que dâ€™imposer une carotte ?</content>
        <advice>
          Relie la tÃ¢che Ã  ses projets : Â« Quâ€™aimes-tu faire qui nÃ©cessite de savoir lire/compter ? Â». Discuter de ses passions (bandes dessinÃ©es, expÃ©riences scientifiques, bricolage) donne du sens Ã  lâ€™effort.

          Fractionnez le travail en objectifs atteignables avec des pauses choisies ensemble. FÃ©licite le processus (persÃ©vÃ©rance, stratÃ©gies utilisÃ©es) plutÃ´t que le rÃ©sultat pour renforcer la fiertÃ© intrinsÃ¨que.
        </advice>
      </card>
      <card category="Gestion du stress parental">
        <content>Tu te sens submergÃ© par les pleurs du soir et crains de perdre patience. Quel rituel de connexion courte pourrais-tu instaurer pour nourrir le lien avant dâ€™aborder le problÃ¨me ?</content>
        <advice>
          Avant la crise, prÃ©vois un rituel ancre : cinq minutes de cÃ¢lin silencieux, une chanson douce ou un massage des mains. Ce moment nourrit ta propre rÃ©serve Ã©motionnelle et rassure ton enfant.

          Identifie ensuite un co-rÃ©gulateur possible (partenaire, proche, respiration guidÃ©e) pour tâ€™accorder un relais lorsque la tension monte. Plus tu anticipes tes besoins de soutien, plus tu peux rester disponible sans te sacrifier.
        </advice>
      </card>
      <card category="Courses au supermarchÃ©">
        <content>Au magasin, ton enfant se roule par terre pour obtenir une friandise. Quelle dÃ©marche en trois temps (connexion, limite, solution) pourrais-tu appliquer sur le moment ?</content>
        <advice>
          Connecte-toi dâ€™abord Ã  son vÃ©cu : mets-toi Ã  sa hauteur et reconnais son envie Â« Tu la trouves trÃ¨s tentante cette friandise ! Â». Le simple fait dâ€™Ãªtre vu apaise souvent lâ€™intensitÃ©.

          RÃ©affirme ensuite la limite : Â« Aujourdâ€™hui nous nâ€™achetons pas de bonbon Â» tout en proposant une alternative prÃ©parÃ©e (choisir le fruit du goÃ»ter, noter la friandise pour une autre occasion). Terminez par une action concrÃ¨te pour le remettre en mouvement : porter la liste, aider Ã  scanner un article, respirer ensemble.
        </advice>
      </card>
      <card category="Questions existentielles">
        <content>Ton enfant de 5 ans te demande si Mamie va mourir bientÃ´t. Comment rÃ©pondre avec honnÃªtetÃ© et douceur tout en accueillant ses Ã©motions ?</content>
        <advice>
          RÃ©ponds avec des mots simples et vrais : Â« Tout le monde meurt un jour, et nous ne savons pas quand. Pour lâ€™instant Mamie est vivante et nous pouvons profiter dâ€™elle Â». Ã‰vite les promesses impossibles tout en restant rassurant.

          Autorise ses Ã©motions : Â« Câ€™est normal que cette question fasse peur ou rende triste Â». Propose-lui une action rÃ©confortante (dessiner pour Mamie, regarder des photos, faire un cÃ¢lin) afin de transformer lâ€™angoisse en lien.
        </advice>
      </card>
      <card category="Matins pressÃ©s">
        <content>Les dÃ©parts Ã  lâ€™Ã©cole sont chaotiques et se terminent en cris. Quelle stratÃ©gie de prÃ©paration la veille et de choix partagÃ©s pourrait fluidifier la routine ?</content>
        <advice>
          PrÃ©parez ensemble la veille : vÃªtements choisis, sac vÃ©rifiÃ©, tableau visuel des Ã©tapes du matin. Plus il participe Ã  lâ€™organisation, plus il se sent copropriÃ©taire de la routine.

          Le matin, donne des repÃ¨res temporels et des choix limitÃ©s (Â« Tu mets dâ€™abord les chaussures ou tu finis ton petit-dÃ©jeuner ? Â»). Un minuteur visuel ou une playlist de durÃ©e fixe peut aussi servir de guide externe pour garder le calme.
        </advice>
      </card>
      <card category="ArrivÃ©e du bÃ©bÃ©">
        <content>Tu attends un nouveau-nÃ© et ton aÃ®nÃ© sâ€™inquiÃ¨te de perdre sa place. Quelle conversation anticipatrice pourrais-tu avoir pour nourrir son besoin de sÃ©curitÃ© et de contribution ?</content>
        <advice>
          Valide ses peurs : Â« Tu te demandes si jâ€™aurai encore du temps pour toi, câ€™est important pour toi Â». Partage concrÃ¨tement comment vous passerez du temps ensemble, mÃªme aprÃ¨s lâ€™arrivÃ©e du bÃ©bÃ©.

          Implique-le dans la prÃ©paration avec des tÃ¢ches valorisantes adaptÃ©es Ã  son Ã¢ge (choisir un vÃªtement, prÃ©parer une chanson). En lui confiant un rÃ´le de grand alliÃ©, tu transformes lâ€™inquiÃ©tude en sentiment de contribution.
        </advice>
      </card>
      <card category="Apaiser un nourrisson">
        <content>Ton futur bÃ©bÃ© pleure malgrÃ© le change et le repas. Quelles Ã©tapes dâ€™observation et de co-rÃ©gulation peux-tu prÃ©voir pour rester prÃ©sent et empathique ?</content>
        <advice>
          Passe en revue calmement les besoins de base (faim, fatigue, confort, contact). Observe son corps pour repÃ©rer des signes de tension ou de douleur et ajuste lâ€™environnement (lumiÃ¨re, bruit, tempÃ©rature).

          Installe un rituel de co-rÃ©gulation : peau Ã  peau, bercements lents, respiration synchronisÃ©e. Chante doucement ou parle-lui pour lâ€™ancrer dans ta prÃ©sence. MÃªme si les pleurs persistent, ton calme lâ€™aide Ã  sentir quâ€™il nâ€™est pas seul.
        </advice>
      </card>
      <card category="RÃ©seau familial">
        <content>Un grand-parent minimise tes limites et offre des friandises en cachette. Comment poser une limite adulte Ã  adulte tout en prÃ©servant la relation ?</content>
        <advice>
          Choisis un moment hors prÃ©sence des enfants pour en parler. Utilise le Â« je Â» : Â« Quand les friandises sont donnÃ©es aprÃ¨s que jâ€™ai dit non, je me sens dÃ©crÃ©dibilisÃ©e et cela complique notre routine Â».

          RÃ©affirme votre objectif commun (le bien-Ãªtre de lâ€™enfant) et propose une alternative claire : Â« Si tu veux lui faire plaisir, nous pouvons prÃ©voir ensemble un goÃ»ter spÃ©cial le mercredi Â». Cette discussion posÃ©e rappelle le cadre tout en reconnaissant sa volontÃ© dâ€™Ãªtre gÃ©nÃ©reux.
        </advice>
      </card>
      <card category="Moments de connexion">
        <content>Tu sens que les obligations prennent le dessus et que les moments de jeu se rarÃ©fient. Quelle micro-activitÃ© de connexion quotidienne pourrais-tu instaurer pour recharger le lien ?</content>
        <advice>
          Identifie un moment clÃ© (rÃ©veil, retour dâ€™Ã©cole, coucher) et consacre-y un rituel court mais exclusif : cinq minutes de jeu du regard, une danse improvisÃ©e, un rÃ©cit Â« le meilleur/le plus drÃ´le de la journÃ©e Â».

          Note-le dans ton agenda comme un rendez-vous non nÃ©gociable. En cÃ©lÃ©brant ce temps partagÃ©, mÃªme bref, tu nourris la complicitÃ© et rends les obligations moins lourdes pour toute la famille.
        </advice>
      </card>
    </cards>
  </script>

  <script>
    class DiscussionCardGame {
      constructor(){
        this.allCards = this.loadCardsFromXML();
        this.cards = [...this.allCards];
        this.availableCards = [...this.cards];
        this.usedCards = [];
        this.currentCard = null;
        this.welcomeCard = {
          category:'Bienvenue',
          content:'Cliquez sur le tas de cartes pour dÃ©couvrir votre premiÃ¨re question de discussion !'
        };
        this.cardEl = document.getElementById('discussionCard');
        this.cardCategoryEl = document.getElementById('cardCategory');
        this.cardContentEl = document.getElementById('cardContent');
        this.deckEl = document.getElementById('cardDeck');
        this.counterEl = document.getElementById('cardCounter');
        this.cardContainerEl = document.getElementById('cardContainer');
        this.floatingParticlesContainer = document.querySelector('.floating-particles');
        this.themeModalEl = document.getElementById('themeSelectorModal');
        this.themeOptionsEl = document.getElementById('themeOptions');
        this.themeErrorEl = document.getElementById('themeError');
        this.selectAllEl = document.getElementById('selectAllThemes');
        this.applyThemeSelectionBtn = document.getElementById('applyThemeSelection');
        this.openThemeSelectorBtn = document.getElementById('openThemeSelector');
        this.expertAdviceBtn = document.getElementById('expertAdviceBtn');
        this.expertAdviceModalEl = document.getElementById('expertAdviceModal');
        this.expertAdviceCategoryEl = document.getElementById('expertAdviceCategory');
        this.expertAdviceSituationEl = document.getElementById('expertAdviceSituation');
        this.expertAdviceContentEl = document.getElementById('expertAdviceContent');
        this.closeExpertAdviceBtn = document.getElementById('closeExpertAdvice');
        this.activeCategories = new Set(this.cards.map(card=>card.category));
        this.updateCounter();
        this.createFloatingParticles();
        this.prepareWelcomeCard();
        this.populateThemeOptions();
        this.bindThemeSelectorEvents();
        this.bindExpertAdviceEvents();
        this.setExpertButtonState(false);
      }

      prepareWelcomeCard(){
        this.currentCard = this.welcomeCard;
        if(this.cardEl){ this.cardEl.classList.remove('flipping'); }
        if(this.cardCategoryEl){ this.cardCategoryEl.textContent = this.welcomeCard.category; }
        if(this.cardContentEl){ this.cardContentEl.textContent = this.welcomeCard.content; }
        this.hideExpertAdvice();
        this.clearExpertAdvicePanel();
        this.setExpertButtonState(false);
      }

      loadCardsFromXML(){
        const xmlData = document.getElementById('cardsData').textContent;
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xmlData,'text/xml');
        const nodes = xmlDoc.querySelectorAll('card');
        return Array.from(nodes).map(card=>{
          const contentNode = card.querySelector('content');
          const adviceNode = card.querySelector('advice');
          return {
            category: card.getAttribute('category'),
            content: contentNode ? contentNode.textContent.trim() : '',
            advice: adviceNode ? adviceNode.textContent.trim() : ''
          };
        });
      }

      _takeRandomCard(){
        if(this.availableCards.length===0){
          this.updateCounter();
          return null;
        }
        const index = Math.floor(Math.random()*this.availableCards.length);
        const card = this.availableCards[index];
        this.usedCards.push(card);
        this.availableCards.splice(index,1);
        this.updateCounter();
        return card;
      }

      drawCard(){
        const card = this._takeRandomCard();
        if(!card){
          this.showNoMoreCards();
          return null;
        }
        this.animateDeck();
        this.currentCard = card;
        this.hideExpertAdvice();
        this.prepareAndFlipCard(card);
        this.setExpertButtonState(Boolean(card.advice));
        return card;
      }

      drawRandomCard(){
        const card = this._takeRandomCard();
        if(!card){ this.showNoMoreCards(); return null; }
        return card;
      }

      prepareAndFlipCard(card){
        this.hideExpertAdvice();
        if(this.cardEl.classList.contains('flipping')){
          this.cardEl.classList.remove('flipping');
          setTimeout(()=>{ this.updateCardContent(card); this.flipCard(); },400);
        }else{
          this.updateCardContent(card); this.flipCard();
        }
      }

      updateCardContent(card){
        this.cardCategoryEl.textContent = card.category;
        this.cardContentEl.textContent = card.content;
        this.clearExpertAdvicePanel();
      }

      flipCard(){
        setTimeout(()=> this.cardEl.classList.add('flipping'),100);
      }

      animateDeck(){
        this.deckEl.style.transform='scale(0.95) translateY(5px)';
        setTimeout(()=>{ this.deckEl.style.transform='scale(1) translateY(0)'; },150);
      }

      updateCounter(){
        this.counterEl.textContent = this.availableCards.length;
      }

      resetDeck(){
        this.availableCards=[...this.cards];
        this.usedCards=[];
        this.updateCounter();
        this.prepareWelcomeCard();
        this.hideExpertAdvice();
      }

      showNoMoreCards(){
        this.cardEl.classList.remove('flipping');
        setTimeout(()=>{
          this.cardCategoryEl.textContent='Fin du Jeu';
          this.cardContentEl.textContent='Toutes les cartes ont Ã©tÃ© piochÃ©es ! Cliquez sur "RÃ©initialiser" pour recommencer.';
          setTimeout(()=> this.cardEl.classList.add('flipping'),100);
        },400);
      }

      createFloatingParticles(){
        const container = this.floatingParticlesContainer;
        if(!container) return;
        for(let i=0;i<20;i++){
          const p = document.createElement('div');
          p.className='particle';
          p.style.left = Math.random()*100+'%';
          p.style.animationDelay = Math.random()*6+'s';
          p.style.animationDuration = (Math.random()*3+3)+'s';
          container.appendChild(p);
        }
      }

      getAllCategories(){
        return Array.from(new Set(this.allCards.map(card=>card.category))).sort();
      }

      populateThemeOptions(){
        if(!this.themeOptionsEl) return;
        const categories = this.getAllCategories();
        this.themeOptionsEl.innerHTML='';
        categories.forEach(category=>{
          const optionId = `theme-${category.toLowerCase().replace(/[^a-z0-9]+/g,'-')}`;
          const label = document.createElement('label');
          label.className='theme-option';
          label.setAttribute('for', optionId);

          const checkbox = document.createElement('input');
          checkbox.type='checkbox';
          checkbox.id = optionId;
          checkbox.value = category;
          checkbox.checked = this.activeCategories.has(category);

          const span = document.createElement('span');
          span.textContent = category;

          label.appendChild(checkbox);
          label.appendChild(span);
          this.themeOptionsEl.appendChild(label);
        });
        this.syncSelectAllCheckbox();
      }

      syncSelectAllCheckbox(){
        if(!this.selectAllEl || !this.themeOptionsEl) return;
        const checkboxes = Array.from(this.themeOptionsEl.querySelectorAll('input[type="checkbox"]'));
        if(checkboxes.length===0){
          this.selectAllEl.checked = false;
          return;
        }
        const allChecked = checkboxes.every(cb=>cb.checked);
        const noneChecked = checkboxes.every(cb=>!cb.checked);
        this.selectAllEl.checked = allChecked;
        if(this.themeErrorEl && !noneChecked){
          this.themeErrorEl.textContent='';
        }
      }

      bindThemeSelectorEvents(){
        if(this.openThemeSelectorBtn){
          this.openThemeSelectorBtn.addEventListener('click', ()=> this.showThemeSelector());
        }
        if(this.applyThemeSelectionBtn){
          this.applyThemeSelectionBtn.addEventListener('click', ()=>{
            const selected = this.getSelectedThemes();
            if(selected.length===0){
              if(this.themeErrorEl){ this.themeErrorEl.textContent='SÃ©lectionnez au moins une thÃ©matique pour commencer.'; }
              return;
            }
            this.applyThemeSelection(selected);
            this.hideThemeSelector();
          });
        }
        if(this.selectAllEl){
          this.selectAllEl.addEventListener('change', (event)=>{
            const checked = event.target.checked;
            if(!this.themeOptionsEl) return;
            this.themeOptionsEl.querySelectorAll('input[type="checkbox"]').forEach(cb=>{ cb.checked = checked; });
            this.syncSelectAllCheckbox();
          });
        }
        if(this.themeOptionsEl){
          this.themeOptionsEl.addEventListener('change', ()=> this.syncSelectAllCheckbox());
        }
      }

      getSelectedThemes(){
        if(!this.themeOptionsEl) return [];
        return Array.from(this.themeOptionsEl.querySelectorAll('input[type="checkbox"]:checked')).map(cb=>cb.value);
      }

      applyThemeSelection(selectedCategories){
        this.activeCategories = new Set(selectedCategories);
        this.cards = this.allCards.filter(card=>this.activeCategories.has(card.category));
        this.availableCards = [...this.cards];
        this.usedCards = [];
        this.updateCounter();
        this.prepareWelcomeCard();
        this.populateThemeOptions();
      }

      setExpertButtonState(enabled){
        if(!this.expertAdviceBtn) return;
        this.expertAdviceBtn.disabled = !enabled;
        this.expertAdviceBtn.setAttribute('aria-disabled', String(!enabled));
      }

      clearExpertAdvicePanel(){
        if(this.expertAdviceCategoryEl){ this.expertAdviceCategoryEl.textContent=''; }
        if(this.expertAdviceSituationEl){ this.expertAdviceSituationEl.textContent=''; }
        if(this.expertAdviceContentEl){ this.expertAdviceContentEl.innerHTML=''; }
      }

      bindExpertAdviceEvents(){
        if(this.expertAdviceBtn){
          this.expertAdviceBtn.addEventListener('click', ()=>{
            if(!this.expertAdviceBtn.disabled){ this.showExpertAdvice(); }
          });
        }
        if(this.closeExpertAdviceBtn){
          this.closeExpertAdviceBtn.addEventListener('click', ()=> this.hideExpertAdvice());
        }
        if(this.expertAdviceModalEl){
          this.expertAdviceModalEl.addEventListener('click', event=>{
            if(event.target===this.expertAdviceModalEl){ this.hideExpertAdvice(); }
          });
        }
      }

      showExpertAdvice(){
        if(!this.currentCard || !this.currentCard.advice || !this.expertAdviceModalEl) return;
        this.populateExpertAdviceContent(this.currentCard);
        this.expertAdviceModalEl.classList.add('visible');
        this.expertAdviceModalEl.setAttribute('aria-hidden','false');
      }

      hideExpertAdvice(){
        if(this.expertAdviceModalEl){
          this.expertAdviceModalEl.classList.remove('visible');
          this.expertAdviceModalEl.setAttribute('aria-hidden','true');
        }
      }

      populateExpertAdviceContent(card){
        if(!this.expertAdviceCategoryEl || !this.expertAdviceSituationEl || !this.expertAdviceContentEl) return;
        this.expertAdviceCategoryEl.textContent = card.category;
        this.expertAdviceSituationEl.textContent = card.content;
        this.expertAdviceContentEl.innerHTML='';
        const paragraphs = card.advice.split(/\n\s*\n/).map(text=>text.trim()).filter(text=>text.length>0);
        if(paragraphs.length===0){
          const fallback = document.createElement('p');
          fallback.textContent = card.advice.trim();
          this.expertAdviceContentEl.appendChild(fallback);
          return;
        }
        paragraphs.forEach(text=>{
          const p = document.createElement('p');
          p.textContent = text;
          this.expertAdviceContentEl.appendChild(p);
        });
      }

      showThemeSelector(){
        if(this.themeModalEl){
          this.populateThemeOptions();
          if(this.themeErrorEl){ this.themeErrorEl.textContent=''; }
          this.themeModalEl.classList.add('visible');
        }
      }

      hideThemeSelector(){
        if(this.themeModalEl){
          this.themeModalEl.classList.remove('visible');
        }
        if(this.themeErrorEl){ this.themeErrorEl.textContent=''; }
      }
    }

    let game;
    function drawCard(){ if(game) game.drawCard(); }
    function resetDeck(){ if(game) game.resetDeck(); }

    window.addEventListener('load', ()=>{
      game = new DiscussionCardGame();
      game.cardContainerEl.classList.add('visible');
      game.cardEl.addEventListener('click', ()=>{
        if(game.currentCard===game.welcomeCard && !game.cardEl.classList.contains('flipping')){
          game.drawCard();
        }else if(game.currentCard && game.currentCard!==game.welcomeCard){
          if(game.cardEl.classList.contains('flipping')){ game.cardEl.classList.remove('flipping'); }
          else{ game.cardEl.classList.add('flipping'); }
        }
      });
      game.showThemeSelector();
    });
  </script>
</body>
</html>
